import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import griddata
from mpl_toolkits.mplot3d import Axes3D 
from scipy.interpolate import Rbf

#plt.close('all')
# Raw data: theta, postFrac, f(theta, postFrac)

data = np.array([
    [100,0.1,3.4609637384060474e-04],
    [100,0.2,-1.9878883251186417e-07],
    [100,0.3,-7.7338460950477674e-07],
    [100,0.4,-1.1389571186130444e-06],
    [100,0.5,-6.6273732881517489e-07],
    [100,0.6,-4.3792619972455514e-07],
    [100,0.7,2.2055590727852620e-07],
    [100,0.8,2.8261367005804461e-07],
    [100,0.9,2.2317151356311630e-04],
    [80,0.1,-1.2116363370277769e-06],
    [80,0.2,-2.4040573744632861e-06],
    [80,0.3,-1.9696285170482349e-06],
    [80,0.4,-1.8114602797404461e-06],
    [80,0.5,-2.3425767327584919e-06],
    [80,0.6,-9.4877255332404843e-07],
    [80,0.7,-8.8285129764457893e-07],
    [80,0.8,-1.9526166241708757e-06],
    [80,0.9,2.4681022911322200e-07],
    [82,0.1,4.7560341474930293e-06],
    [82,0.2,-2.3216179740144166e-06],
    [82,0.3,-1.8903520235272588e-06],
    [82,0.4,-1.7179036878211644e-06],
    [82,0.5,-1.7098767888500522e-06],
    [82,0.6,-8.1481780451624923e-07],
    [82,0.7,-7.1857985909365536e-07],
    [82,0.8,-1.6536331297447415e-08],
    [82,0.9,1.0363350509261377e-07],
    [84,0.1,1.1609900779418794e-04],
    [84,0.2,-2.1351080203563641e-06],
    [84,0.3,-1.7997550178430141e-06],
    [84,0.4,-1.6236731913479479e-06],
    [84,0.5,-1.4303058139140173e-06],
    [84,0.6,-7.0736172464843406e-07],
    [84,0.7,-5.8638742491471546e-07],
    [84,0.8,3.5493427499387760e-07],
    [84,0.9,-9.2023060437452636e-08],
    [86,0.1,3.3353990345790603e-04],
    [86,0.2,-1.9287453007598943e-06],
    [86,0.3,-1.7163607366002193e-06],
    [86,0.4,-1.5295306902902768e-06],
    [86,0.5,-1.2423718185599718e-06],
    [86,0.6,-6.1535991486278694e-07],
    [86,0.7,-4.5404239225014699e-07],
    [86,0.8,2.3348553513962790e-08],
    [86,0.9,1.0640344881488862e-06],
    [88,0.1,1.3688199205636833e-04],
    [88,0.2,-1.6630365927192243e-06],
    [88,0.3,-1.6400176462684273e-06],
    [88,0.4,-1.4364405169081126e-06],
    [88,0.5,-1.1010616532849517e-06],
    [88,0.6,-5.1787834302034028e-07],
    [88,0.7,-3.3877205957222217e-07],
    [88,0.8,-5.4154381555615721e-07],
    [88,0.9,-4.2945422924153818e-07],
    [90,0.1,1.5319164872920762e-04],
    [90,0.2,-1.2917651440299871e-06],
    [90,0.3,-1.5671575882178282e-06],
    [90,0.4,-1.3570442390424048e-06],
    [90,0.5,-9.7530076043157304e-07],
    [90,0.6,-3.8207541044878385e-07],
    [90,0.7,-2.3704087914270885e-07],
    [90,0.8,-1.8277454540045906e-07],
    [90,0.9,1.5122973710322650e-04],
    [92,0.1,3.7974131789564574e-04],
    [92,0.2,-7.3249892463630035e-07],
    [92,0.3,-1.4987624927023970e-06],
    [92,0.4,-1.2774258366526810e-06],
    [92,0.5,-8.8191919861820462e-07],
    [92,0.6,-1.1051431191494827e-06],
    [92,0.7,-1.6551341437761719e-07],
    [92,0.8,-1.3907138711280295e-08],
    [92,0.9,1.8999857990412727e-04],
    [94,0.1,2.8335972027417701e-04],
    [94,0.2,6.2937267893780476e-07],
    [94,0.3,-1.4388853254932780e-06],
    [94,0.4,-1.2215494739524727e-06],
    [94,0.5,-8.0099335773635261e-07],
    [94,0.6,-7.5025978186452952e-07],
    [94,0.7,-7.5479513549267427e-08],
    [94,0.8,1.0792036504596807e-07],
    [94,0.9,3.9032605964051257e-05],
    [96,0.1,1.5652679949315382e-04],
    [96,0.2,8.1938662774898007e-05],
    [96,0.3,-1.3673205591621083e-06],
    [96,0.4,-1.1794950239510081e-06],
    [96,0.5,-7.3371940710336761e-07],
    [96,0.6,-6.1910546264465289e-07],
    [96,0.7,-1.3440977159143828e-08],
    [96,0.8,2.1976579174400051e-07],
    [96,0.9,2.0544516051555501e-04],
    [98,0.1,2.4802101711931054e-04],
    [98,0.2,1.7051401169356210e-06],
    [98,0.3,-1.3444939581410385e-06],
    [98,0.4,-1.1479573891218698e-06],
    [98,0.5,-6.9214331095573702e-07],
    [98,0.6,-5.1627349933935871e-07],
    [98,0.7,-1.4331035083614792e-07],
    [98,0.8,5.4992973784760374e-07],
    [98,0.9,6.1355613314132131e-05]
])


# Extract columns
theta = data[:,0]
postFrac = data[:,1]
f = data[:,2]

# Create grid for interpolation
theta_grid = np.linspace(theta.min(), theta.max(), 100)
postFrac_grid = np.linspace(postFrac.min(), postFrac.max(), 100)
Theta, PostFrac = np.meshgrid(theta_grid, postFrac_grid)

# Interpolate data onto grid
F_grid = griddata((theta, postFrac), f, (Theta, PostFrac), method='cubic')

# Create surface plot
fig = plt.figure(figsize=(8,6))
ax = fig.add_subplot(111, projection='3d')

# Plot surface
surf = ax.plot_surface(Theta, PostFrac, F_grid, cmap='viridis', edgecolor='none')
#wire = ax.plot_wireframe(Theta, PostFrac, F_grid, color='navy', linewidth=0.8)

# Labels and title
ax.set_xlabel(r'$\theta_E$')
ax.set_ylabel('postFraction')
ax.set_zlabel('droplet velocity')
fig.colorbar(surf, ax=ax, shrink=0.5, aspect=8, label='velocity')

plt.tight_layout()
plt.show()

# Build smooth interpolating function using Radial Basis Functions
rbf = Rbf(theta, postFrac, f, function='multiquadric', smooth=0)

# Create fine grid
theta_grid = np.linspace(theta.min(), theta.max(), 500)
postFrac_grid = np.linspace(postFrac.min(), postFrac.max(), 500)
Theta, PostFrac = np.meshgrid(theta_grid, postFrac_grid)

# Evaluate interpolating function
F_interp = rbf(Theta, PostFrac)

# Find maximum
max_index = np.unravel_index(np.argmax(F_interp), F_interp.shape)
theta_max = Theta[max_index]
postFrac_max = PostFrac[max_index]
f_max = F_interp[max_index]

print(f"Maximum interpolated value: {f_max:.6e}")
print(f"At theta = {theta_max:.3f}, postFrac = {postFrac_max:.3f}")
